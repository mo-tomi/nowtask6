# フェーズ 6.7, 6.8, 6.9 実装計画

**対象フェーズ:**
- Phase 6.7: アクセシビリティの向上
- Phase 6.8: エラーハンドリングとユーザーフィードバック
- Phase 6.9: ヘルプとオンボーディング

**実装スケジュール:** 2025年10月16日
**想定完了時間:** 1日
**優先度:** 高

---

## 📋 フェーズ 6.7: アクセシビリティの向上

### 目標
WCAG 2.1 AA 準拠のアクセシビリティ対応により、すべてのユーザーが使用可能なアプリにする

### 6.7.1: スクリーンリーダー対応

#### 実装内容
1. **全 UI 要素への aria-label 追加**
   - ボタン: aria-label で目的を明確化
   - アイコン: aria-label="説明テキスト"
   - フォーム: label 要素と紐付け

2. **フォーカス順序の最適化**
   - tabindex 属性の適切な設定
   - フォーカス順序を論理的に
   - キーボードナビゲーション対応

3. **ARIA ロールの実装**
   - role="progressbar": ゲージ
   - role="region": セクション
   - role="status": ステータス情報
   - role="button": カスタムボタン
   - role="dialog": モーダル

#### ターゲット要素

```html
<!-- 検索入力 -->
<input aria-label="タスクを検索" type="text">

<!-- 完了チェック -->
<input aria-label="タスク名の完了状態を切り替え" type="checkbox">

<!-- タスク項目 -->
<div role="listitem" aria-label="タスク名, 期限日時">...</div>

<!-- モーダル -->
<div role="dialog" aria-labelledby="modal-title">...</div>

<!-- タイマー -->
<div role="status" aria-live="polite" aria-label="累積時間: 0時間0分">...</div>
```

---

### 6.7.2: コントラスト比の確保

#### 実装内容
1. **WCAG AA 基準（4.5:1）の達成**
   - 本文テキスト: 4.5:1 以上
   - 大きなテキスト: 3:1 以上
   - UI コンポーネント: 3:1 以上

2. **重要な要素のコントラスト強化**
   - ボタン: 背景色と前景色の差を増加
   - テキストリンク: 下線またはアイコンで識別
   - 入力フィールド: フォーカス時に色変更

3. **ハイコントラストモードの追加**
   - `@media (prefers-contrast: more)` 対応
   - モノクロデザイン維持

#### CSS 実装例

```css
/* 標準モード */
body {
  color: #212121; /* 背景: #ffffff */
  /* コントラスト比: 14:1 */
}

/* ハイコントラストモード */
@media (prefers-contrast: more) {
  body {
    color: #000000;
  }
  button {
    border: 2px solid currentColor;
  }
}
```

---

### 6.7.3: 文字サイズとタップ領域

#### 実装内容
1. **最小フォントサイズの確保（14sp 以上）**
   - 本文: 14-16px
   - 見出し: 18-24px
   - ラベル: 12-14px（最小）

2. **タップ領域の最小サイズ確保（48dp × 48dp）**
   - ボタン: 最小 44×44px
   - リンク: 最小 48×48px
   - チェックボックス: 最小 24×24px

3. **アイコンボタンの拡大**
   - パディング増加: 12px → 16px
   - ホバー領域の拡大

#### 実装例

```css
button {
  min-width: 48px;
  min-height: 48px;
  padding: 12px 16px;
  font-size: 14px;
}

a {
  padding: 8px;
  /* 実質タップ領域: 48px × 48px */
}
```

---

## 🎯 フェーズ 6.8: エラーハンドリングとユーザーフィードバック

### 目標
ユーザーに対して明確で親切なフィードバックを提供し、エラーからの回復を容易にする

### 6.8.1: エラーメッセージの改善

#### 実装内容
1. **ユーザーフレンドリーなエラー文言**
   - 技術用語を避ける
   - 問題を明確に説明
   - 解決策を提示

2. **具体的な解決策の提示**
   ```
   ❌ 悪い例: "エラーが発生しました"
   ✅ 良い例: "タスク名を入力してください"
            "データの保存に失敗しました。インターネット接続を確認してください"
   ```

3. **エラータイプ別のアイコン表示**
   - ⚠️ 警告（入力エラー）
   - ❌ エラー（保存失敗）
   - ℹ️ 情報（確認メッセージ）
   - ✅ 成功（操作完了）

4. **エラーログの詳細表示（デバッグモード）**
   - localStorage に `debugMode: true` で有効化
   - コンソール出力を強化

#### エラータイプとメッセージ

```javascript
const errorMessages = {
  INVALID_DATE: "期限日が無効です。YYYY-MM-DD 形式で入力してください",
  INVALID_TIME: "時刻が無効です。HH:MM 形式で入力してください",
  EMPTY_TITLE: "タスク名を入力してください",
  NETWORK_ERROR: "ネットワーク接続エラー。インターネット接続を確認してください",
  STORAGE_ERROR: "データの保存に失敗しました。再度お試しください",
  QUOTA_ERROR: "ストレージが満杯です。古いデータを削除してください"
};
```

---

### 6.8.2: 操作フィードバックの強化

#### 実装内容
1. **保存成功時のトースト表示**
   - メッセージ: "タスクを追加しました" (3秒表示)
   - 位置: 画面下部
   - アニメーション: フェードイン/アウト

2. **削除時のアンドゥ機能（5秒間）**
   - メッセージ: "タスクを削除しました  [アンドゥ]"
   - 自動ロールバック: 5秒後に本削除
   - クリック可能な「アンドゥ」ボタン

3. **同期中インジケーター**
   - Firestore 同期中に spinner 表示
   - テキスト: "データを同期中..."
   - タイムアウト: 10秒

4. **オフライン状態の明確な表示**
   - ヘッダーに "オフラインモード" バッジ
   - 自動的に表示/非表示
   - ユーザーに通知

#### 実装例

```javascript
// トースト表示
function showToast(message, duration = 3000) {
  const toast = document.createElement('div');
  toast.className = 'toast success';
  toast.textContent = message;
  document.body.appendChild(toast);

  setTimeout(() => {
    toast.classList.add('show');
  }, 10);

  setTimeout(() => {
    toast.remove();
  }, duration + 300);
}

// アンドゥ機能
function deleteWithUndo(taskId, taskData) {
  const undoButton = document.createElement('button');
  undoButton.textContent = 'アンドゥ';
  undoButton.onclick = () => restoreTask(taskId, taskData);

  showToast('タスクを削除しました', 5000, undoButton);
}
```

---

### 6.8.3: ローディング状態の改善

#### 実装内容
1. **スケルトンスクリーンの実装**
   - タスク読み込み中に placeholder 表示
   - グラデーションアニメーション
   - より良い UX

2. **プログレスバーの表示**
   - Firestore 同期進捗表示
   - 複数ファイルアップロード時

3. **タイムアウト処理**
   - 10秒以上応答がない場合、"再試行" ボタン表示
   - ユーザーに通知

4. **リトライボタンの追加**
   - 失敗時に "再試行" ボタン表示
   - 最大 3 回まで自動リトライ

---

## 📚 フェーズ 6.9: ヘルプとオンボーディング

### 目標
新規ユーザーが迅速に機能を理解し、アプリを最大限に活用できるようにサポート

### 6.9.1: 初回起動時のチュートリアル

#### 実装内容
1. **スワイプ操作のガイド**
   - 右スワイプ: "タスクを完了"
   - 左スワイプ: "タスクを削除"
   - 視覚的なアニメーション付き

2. **主要機能のツアー**
   - ステップ 1: クイック入力
   - ステップ 2: ゲージ表示
   - ステップ 3: タスク検索
   - ステップ 4: バッチ操作

3. **スキップ可能な設計**
   - "スキップ" ボタンで途中終了可能
   - 後からいつでも再表示可能

4. **再表示オプション**
   - 設定画面に "チュートリアルを再表示" オプション
   - ローカルストレージで状態を管理

#### 実装例

```javascript
const tutorialSteps = [
  {
    target: '#quick-add-input',
    title: 'クイック入力',
    description: 'ここにタスク名を入力してEnterキーで追加',
    position: 'bottom'
  },
  {
    target: '#time-gauge-container',
    title: '24時間ゲージ',
    description: '今日の時間配分が一目でわかります',
    position: 'bottom'
  },
  // ...
];
```

---

### 6.9.2: コンテキストヘルプ

#### 実装内容
1. **ツールチップの追加**
   - ホバー時に機能説明表示
   - 遅延: 500ms
   - 最大幅: 200px

2. **ヘルプアイコンの配置**
   - ? アイコンをキーの機能の横に配置
   - クリックでヘルプテキスト表示

3. **FAQ ページの作成**
   - よくある質問と回答
   - 検索機能付き
   - 画像付き説明

4. **操作ガイドの動画リンク**
   - YouTube 動画へのリンク
   - 各機能ごとに 1-2 分の説明動画

#### ツールチップ実装

```html
<button title="タスクを複数選択して一括操作できます"
        class="help-icon-tooltip">
  ⓘ
</button>

<style>
.help-icon-tooltip:hover::after {
  content: attr(title);
  position: absolute;
  background: #333;
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-top: 8px;
}
</style>
```

---

### 6.9.3: ショートカットガイド

#### 実装内容
1. **ジェスチャー一覧**
   - 右スワイプ: 完了/未完了
   - 左スワイプ: 削除
   - 長押し: (将来の機能)
   - ダブルタップ: (将来の機能)

2. **クイックアクション一覧**
   - 今日のタスク一括完了
   - 期限切れタスク移動
   - 完了タスクアーカイブ
   - 未完了タスクコピー

3. **設定画面からのアクセス**
   - 設定 > ヘルプ > ショートカット
   - 印刷可能なチートシート

#### HTML 例

```html
<div class="shortcuts-guide">
  <h3>ジェスチャーショートカット</h3>
  <div class="shortcut-item">
    <div class="gesture">右スワイプ →</div>
    <div class="action">タスク完了</div>
  </div>
  <div class="shortcut-item">
    <div class="gesture">← 左スワイプ</div>
    <div class="action">タスク削除</div>
  </div>
</div>
```

---

## 🛠️ 技術実装詳細

### 共通実装ファイル

| ファイル | 変更内容 |
|---------|---------|
| `js/accessibility.js` (NEW) | アクセシビリティ機能（12 関数） |
| `js/feedback.js` (NEW) | ユーザーフィードバック機能（8 関数） |
| `js/help.js` (NEW) | ヘルプ・チュートリアル機能（10 関数） |
| `style.css` | トースト、スケルトン、ハイコントラストのスタイル追加 |
| `index.html` | 新しいスクリプト読み込み、要素の ARIA ラベル更新 |
| `docs/ACCESSIBILITY.md` | アクセシビリティガイドライン |

---

## 📊 実装統計（予想）

| 項目 | 数値 |
|------|------|
| accessibility.js | ~250行 |
| feedback.js | ~200行 |
| help.js | ~300行 |
| CSS 追加 | ~150行 |
| テストケース | 15-20個 |
| ドキュメント | 5 ファイル |

---

## ✅ 実装順序

### フェーズ 6.7（アクセシビリティ）
1. aria-label の追加/更新
2. フォーカス管理の実装
3. コントラスト比の改善
4. フォントサイズとタップ領域

### フェーズ 6.8（エラーハンドリング）
1. トースト機能の実装
2. アンドゥ機能の実装
3. ローディング状態の改善
4. オフライン状態の表示

### フェーズ 6.9（ヘルプ・オンボーディング）
1. チュートリアルの実装
2. ツールチップの追加
3. FAQ ページの作成
4. ショートカットガイド

---

**フェーズ 6.7, 6.8, 6.9 実装計画 完成**
